## SwapMeet - Доска объявлений

**SwapMeet** — сервис доски объявлений, реализованный в микросервисной архитектуре. Он предоставляет API для работы с категориями, объявлениями и другими сущностями.


## Основные функции
* Получение списка категорий (доступно всем ролям и неавторизованным пользователям)  
* Создание новых категорий (доступно только авторизованным пользователям с ролями Модератор и Администратор).
* Получение списка опубликованных объявлений (доступно всем ролям, но у неавторизованных пользователей часть полей будет скрыта\замаскирована).
* Получение опубликованного объявления по его идентификатору (доступно всем ролям, но у неавторизованных пользователей часть полей будет скрыта\замаскирована).
* Получение списка объявлений авторизованного пользователя (доступно всем ролям, но пользователь должен быть авторизован).
* Создание новых объявлений (доступно всем ролям и только авторизованным пользователям).
* Редактирование существующих объявлений (доступно всем ролям и только авторизованным пользователям).
* Отправка объявления пользователем на модерацию (доступно всем ролям и только авторизованным пользователям).
* Получение списка всех объявлений с возможностью фильтрации по статусам и категориям (доступно только авторизованным пользователям с ролями Модератор и Администратор).
* Публикация объявлений из статуса "На модерации" (доступно только авторизованным пользователям с ролями Модератор и Администратор).
* Возврат объявлений(из любого статуса) в черновики (доступно только авторизованным пользователям с ролями Модератор и Администратор).


## Особенности
* Сервис использует БД PpostgreSQL и кэш на базе Redis.
* В некоторых API интерфейсах сервиса используется авторизация на основе JWT (передаётся в качестве входного параметра). При этом, валидация токенов осуществляется на месте, т.е. на стороне сервиса **SwapMeet** (как и извлечение "пайлоада"), без выполнения запросов к сервису авторизации.  
* При запуске сервиса производится прогрев кэша(категории и опубликованные объявления)


## API

В целом, с API можно ознакомиться изучив proto-файл: [swapmeet.proto](/proto/swapmeet.proto)

**SwapMeet** реализует gRPC сервис с следующими "ручками":


### 1. **GetCategories**

**Описание**: Получение списка категорий. Данный вызов доступен всем категориям пользователей. При подготовке ответа используется кэш.

### 2. **CreateCategory**

**Описание**: Создание новой категории. При обработке вызова к данному сервису производится проверка наличия валидного токена доступа, а также доступной роли Модератор или Администратор. Других проверок не выполняется.  

### 3. **GetPublishedAdvertisements**

**Описание**: Получение опубликованных объявлений (т.е. в статусе `published`). Данный сервис доступен как авторизованым, так и неавторизованным пользователям(т.о. передача токена доступа опциональна). Различие для авторизованных и неавторизованных пользователей будет заключаться в том, что для неавторизованных пользователей поле "ContactInfo" будет маскировано(в нём для всех объявлений будет сообщение - `"Для просмотра необходимо авторизоваться"`). 
* Вызов предусматривает возможность фильтрации по списку идентификаторов категорий.
* Если список категорий пуст, для формирования ответа на запрос используется кэш.

### 4. **GetPublishedAdvertisementByID**

**Описание**: Получение опубликованного объявления по его ID. В целом, метод аналогичен `GetPublishedAdvertisements`, но возвращает только одно объявление 


### 5. **GetUserAdvertisements**

**Описание**: Получение объявлений конкретного пользователя. Вызов доступен только для авторизованных пользователей, т.е. с валидным токеном доступа(из "пайлоада" которого будет извлечен идентификатор пользователя и произведен поиск соответствующих объявлений). 


### 6. **CreateAdvertisement**

**Описание**: Создание нового объявления. Вызов доступен только для авторизованных пользователей, т.е. с валидным токеном доступа. Других проверок не выполняется. 


### 7. **UpdateAdvertisement**

**Описание**: Изменение существующего объявления. Вызов доступен только для авторизованных пользователей, т.е. с валидным токеном доступа. За исключением поиска объявления по переданному идентификатору и идентификатору пользователя(извлеченному из "пайлоада"), других проверок не выполняется. 


### 8. **SubmitAdvertisementForModeration**

**Описание**: Отправка объявления на модерацию. Вызов доступен только для авторизованных пользователей, т.е. с валидным токеном доступа. За исключением поиска объявления по переданному идентификатору и идентификатору пользователя(извлеченному из "пайлоада"), других проверок не выполняется. 


### 9. **GetModerationAdvertisements**

**Описание**: Получение списка всех объявлений. Возможна фильтрация по статусам и по категориям. При обработке вызова производится проверка наличия валидного токена доступа, а также доступной роли Модератор или Администратор.  


### 10. **PublishAdvertisement**

**Описание**: Публикация объявления(объявление должно быть в статусе "На модерации", т.е. `moderation`). При обработке вызова производится проверка наличия валидного токена доступа, а также доступной роли Модератор или Администратор. 


### 11. **ReturnAdvertisementToDraft**

**Описание**: Возврат объявления в черновики(статус `draft`) из любого статуса. При обработке вызова производится проверка наличия валидного токена доступа, а также доступной роли Модератор или Администратор.  